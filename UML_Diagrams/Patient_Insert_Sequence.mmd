%% Patient Insert Sequence Diagram
sequenceDiagram
    actor User
    participant Control as PatientControl
    participant Form as PatientForm
    participant Repository as PatientRepository
    participant BaseRepo as BaseRepository
    participant DB as DatabaseHelper
    participant Database as SQL Server

    User->>Control: Click "Add" button
    activate Control

    Control->>Control: btnAdd_Click()
    Control->>Form: CreateEntityForm()
    activate Form
    Form->>Form: new PatientForm()
    Form-->>Control: PatientForm instance
    Control->>Form: ShowDialog()

    User->>Form: Fill patient data
    User->>Form: Click "Save" button

    Form->>Form: Validate patient data
    Form->>Repository: Insert(patient)
    activate Repository

    Repository->>BaseRepo: Insert(patient)
    activate BaseRepo

    BaseRepo->>DB: GetConnection()
    activate DB
    DB-->>BaseRepo: SqlConnection
    deactivate DB

    BaseRepo->>Repository: CreateInsertCommand(patient, con)
    activate Repository
    Repository->>Repository: AddPatientParameters(cmd, patient)
    Repository-->>BaseRepo: SqlCommand
    deactivate Repository

    BaseRepo->>Database: ExecuteScalar()
    activate Database
    Database-->>BaseRepo: New PatientID
    deactivate Database

    BaseRepo->>Repository: SetEntityId(patient, id)
    activate Repository
    Repository-->>BaseRepo: void
    deactivate Repository

    BaseRepo-->>Repository: true (success)
    deactivate BaseRepo

    Repository-->>Form: true (success)
    deactivate Repository

    Form->>Form: DialogResult = OK
    Form-->>Control: DialogResult.OK
    deactivate Form

    Control->>Control: LoadData()
    Control->>Repository: GetAll()
    activate Repository
    Repository->>BaseRepo: GetAll()
    activate BaseRepo
    BaseRepo->>Database: SELECT * FROM tblPatient
    activate Database
    Database-->>BaseRepo: ResultSet
    deactivate Database
    BaseRepo-->>Repository: List of Patient
    deactivate BaseRepo
    Repository-->>Control: List of Patient
    deactivate Repository

    Control->>Control: Refresh DataGridView
    Control->>User: Show success message
    deactivate Control

